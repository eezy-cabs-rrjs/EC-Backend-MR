<app-header></app-header>

<!-- Status Banner -->
<div *ngIf="kycStatus !== 'INCOMPLETE'" class="status-container">
     <div class="status-banner" [ngClass]="{
    'approved': kycStatus === 'APPROVED',
    'rejected': kycStatus === 'REJECTED',
    'pending': kycStatus === 'SUBMITTED'
  }">
          <div class="status-icon">
               <i *ngIf="kycStatus === 'APPROVED'" class="fas fa-check-circle"></i>
               <i *ngIf="kycStatus === 'REJECTED'" class="fas fa-exclamation-circle"></i>
               <i *ngIf="kycStatus === 'SUBMITTED'" class="fas fa-clock"></i>
          </div>
          <div class="status-content">
               <h3>
                    {{
                    kycStatus === 'APPROVED'
                    ? 'KYC Verified'
                    : kycStatus === 'REJECTED'
                    ? 'KYC Rejected'
                    : 'KYC Under Review'
                    }}
               </h3>
               <p *ngIf="kycStatus === 'REJECTED'">Reason: {{rejectionReason}}</p>
               <p *ngIf="kycStatus === 'SUBMITTED'">Your documents are being reviewed. This may take 1-2 business days.
               </p>
          </div>
     </div>
</div>

<div class="page-container">
     <div class="form-card">
          <!-- Form Header -->
          <div class="form-header">
               <h1>Driver Verification</h1>
               <p class="form-description">Complete your Know Your Customer (KYC) information to start accepting rides
               </p>
          </div>

          <form (ngSubmit)="onSubmit()" #kycForm="ngForm" class="kyc-form">
               <!-- Driver Details Section -->
               <div class="form-section">
                    <div class="section-header">
                         <div class="section-number">1</div>
                         <h2>Driver Information</h2>
                    </div>

                    <div class="form-grid">
                         <!-- Driver License -->
                         <div class="form-group"
                              [class.invalid]="driverLicense.invalid && (driverLicense.touched || submitted)">
                              <label for="driverLicense">Driver's License Number</label>
                              <input type="text" id="driverLicense" name="driverLicense"
                                   [(ngModel)]="driverDetails.driverLicense" #driverLicense="ngModel"
                                   [readonly]="!isEditable" required minlength="5" maxlength="15" class="form-control"
                                   placeholder="DL123456789" />
                              <div *ngIf="driverLicense.invalid && (driverLicense.touched || submitted) && isEditable"
                                   class="validation-error">
                                   <small *ngIf="driverLicense.errors?.['required']">License number is required</small>
                                   <small
                                        *ngIf="driverLicense.errors?.['minlength'] || driverLicense.errors?.['maxlength']">
                                        Must be 5-15 characters
                                   </small>
                              </div>
                              <div *ngIf="isEditable && kycStatus !== 'SUBMITTED'" class="hint-text">
                                   Your government-issued driver's license number
                              </div>
                         </div>

                         <!-- Experience -->
                         <div class="form-group"
                              [class.invalid]="experience.invalid && (experience.touched || submitted)">
                              <label for="experience">Driving Experience</label>
                              <input type="text" id="experience" name="experience"
                                   [(ngModel)]="driverDetails.experience" #experience="ngModel" [readonly]="!isEditable"
                                   required pattern="^[0-9]+\s*years?$" class="form-control"
                                   placeholder="e.g., 5 years" />
                              <div *ngIf="experience.invalid && (experience.touched || submitted) && isEditable"
                                   class="validation-error">
                                   <small *ngIf="experience.errors?.['required']">Experience is required</small>
                                   <small *ngIf="experience.errors?.['pattern']">Format: "X years" (e.g., "5
                                        years")</small>
                              </div>
                              <div *ngIf="isEditable && kycStatus !== 'SUBMITTED'" class="hint-text">
                                   Your total professional driving experience
                              </div>
                         </div>
                    </div>
               </div>

               <!-- Vehicle Details Section -->
               <div class="form-section">
                    <div class="section-header">
                         <div class="section-number">2</div>
                         <h2>Vehicle Information</h2>
                    </div>

                    <div class="form-grid">
                         <!-- Vehicle Number -->
                         <div class="form-group"
                              [class.invalid]="vehicleNumber.invalid && (vehicleNumber.touched || submitted)">
                              <label for="vehicleNumber">License Plate Number</label>
                              <input type="text" id="vehicleNumber" name="vehicleNumber"
                                   [(ngModel)]="vehicleDetails.vehicleNumber" #vehicleNumber="ngModel"
                                   [readonly]="!isEditable" required maxlength="10" pattern="[A-Z0-9]+"
                                   class="form-control" placeholder="ABC1234" />
                              <div *ngIf="vehicleNumber.invalid && (vehicleNumber.touched || submitted) && isEditable"
                                   class="validation-error">
                                   <small *ngIf="vehicleNumber.errors?.['required']">Plate number is required</small>
                                   <small *ngIf="vehicleNumber.errors?.['pattern']">Only letters and numbers
                                        allowed</small>
                              </div>
                         </div>

                         <!-- Chassis Number -->
                         <div class="form-group"
                              [class.invalid]="chassisNumber.invalid && (chassisNumber.touched || submitted)">
                              <label for="chassisNumber">Chassis Number (VIN)</label>
                              <input type="text" id="chassisNumber" name="chassisNumber"
                                   [(ngModel)]="vehicleDetails.chassisNumber" #chassisNumber="ngModel"
                                   [readonly]="!isEditable" required class="form-control"
                                   placeholder="17-character identifier" />
                              <div *ngIf="chassisNumber.invalid && (chassisNumber.touched || submitted)"
                                   class="validation-error">
                                   <small *ngIf="chassisNumber.errors?.['required']">Chassis number is required</small>
                              </div>
                         </div>

                         <!-- Insurance Number -->
                         <div class="form-group"
                              [class.invalid]="insuranceNumber.invalid && (insuranceNumber.touched || submitted)">
                              <label for="insuranceNumber">Insurance Policy Number</label>
                              <input type="text" id="insuranceNumber" name="insuranceNumber"
                                   [(ngModel)]="vehicleDetails.insuranceNumber" #insuranceNumber="ngModel"
                                   [readonly]="!isEditable" required class="form-control" />
                              <div *ngIf="insuranceNumber.invalid && (insuranceNumber.touched || submitted)"
                                   class="validation-error">
                                   <small *ngIf="insuranceNumber.errors?.['required']">Insurance number is
                                        required</small>
                              </div>
                         </div>

                         <!-- Insurance Expiry Date -->
                         <div class="form-group"
                              [class.invalid]="insuranceExpiry.invalid && (insuranceExpiry.touched || submitted)">
                              <label for="insuranceExpiry">Insurance Expiry Date</label>
                              <input type="date" id="insuranceExpiry" name="insuranceExpiry"
                                   [(ngModel)]="vehicleDetails.insuranceExpiry" #insuranceExpiry="ngModel"
                                   [readonly]="!isEditable" required class="form-control" />
                              <div *ngIf="insuranceExpiry.invalid && (insuranceExpiry.touched || submitted)"
                                   class="validation-error">
                                   <small *ngIf="insuranceExpiry.errors?.['required']">Expiry date is required</small>
                              </div>
                         </div>

                         <!-- Registration Date -->
                         <div class="form-group"
                              [class.invalid]="registrationDate.invalid && (registrationDate.touched || submitted)">
                              <label for="registrationDate">Registration Date</label>
                              <input type="date" id="registrationDate" name="registrationDate"
                                   [(ngModel)]="vehicleDetails.registrationDate" #registrationDate="ngModel"
                                   [readonly]="!isEditable" required class="form-control" />
                              <div *ngIf="registrationDate.invalid && (registrationDate.touched || submitted)"
                                   class="validation-error">
                                   <small *ngIf="registrationDate.errors?.['required']">Registration date is
                                        required</small>
                              </div>
                         </div>

                         <!-- Vehicle Make -->
                         <div class="form-group"
                              [class.invalid]="vehicleMake.invalid && (vehicleMake.touched || submitted)">
                              <label for="vehicleMake">Make</label>
                              <input type="text" id="vehicleMake" name="vehicleMake"
                                   [(ngModel)]="vehicleDetails.vehicleMake" #vehicleMake="ngModel"
                                   [readonly]="!isEditable" required class="form-control" placeholder="e.g., Toyota" />
                              <div *ngIf="vehicleMake.invalid && (vehicleMake.touched || submitted)"
                                   class="validation-error">
                                   <small *ngIf="vehicleMake.errors?.['required']">Make is required</small>
                              </div>
                         </div>

                         <!-- Vehicle Model -->
                         <div class="form-group"
                              [class.invalid]="vehicleModel.invalid && (vehicleModel.touched || submitted)">
                              <label for="vehicleModel">Model</label>
                              <input type="text" id="vehicleModel" name="vehicleModel"
                                   [(ngModel)]="vehicleDetails.vehicleModel" #vehicleModel="ngModel"
                                   [readonly]="!isEditable" required class="form-control" placeholder="e.g., Camry" />
                              <div *ngIf="vehicleModel.invalid && (vehicleModel.touched || submitted)"
                                   class="validation-error">
                                   <small *ngIf="vehicleModel.errors?.['required']">Model is required</small>
                              </div>
                         </div>

                         <!-- Year of Manufacture -->
                         <div class="form-group"
                              [class.invalid]="yearOfManufacture.invalid && (yearOfManufacture.touched || submitted)">
                              <label for="yearOfManufacture">Year</label>
                              <input type="number" id="yearOfManufacture" name="yearOfManufacture"
                                   [(ngModel)]="vehicleDetails.yearOfManufacture" #yearOfManufacture="ngModel"
                                   [readonly]="!isEditable" required class="form-control" placeholder="e.g., 2018" />
                              <div *ngIf="yearOfManufacture.invalid && (yearOfManufacture.touched || submitted)"
                                   class="validation-error">
                                   <small *ngIf="yearOfManufacture.errors?.['required']">Year is required</small>
                              </div>
                         </div>
                    </div>
               </div>

               <!-- Form Actions -->
               <div class="form-actions">
                    <button type="button" class="btn btn-outline" (click)="toggleEdit()"
                         *ngIf="kycStatus !== 'INCOMPLETE'">
                         {{ isEditable ? 'Cancel' : 'Edit Information' }}
                    </button>
                    <button type="submit" class="btn btn-primary"
                         [disabled]="!isEditable || (!kycForm.form.valid && submitted)">
                         {{ kycStatus === 'SUBMITTED' ? 'Update Verification' : 'Submit for Verification' }}
                    </button>
               </div>
          </form>
     </div>
</div>

<app-footer></app-footer>